


			<div class="col-lg-6">
				<div class="main_character col-lg-12">
					<h5><b>Drag a character to an empty space.</b></h5>

					<div class="maze-character">
						<table class="table table-bordered col-lg-12">
							<tr>
								<td width="25%" height="110">
									<a href="#" class="list-group-item" onmousedown="javascript:saveMainCharacter(1);">
										<h5>Dog</h5>
										<img src="<%= asset_path('dog.png'); %>" width="50" class="draggable maincharacter" />
									</a>
								</td>
								<td width="25%">
									<a href="#" class="list-group-item" onmousedown="javascript:saveMainCharacter(2);">
										<h5>Cat</h5>
										<img src="<%= asset_path('cat-icon.png'); %>" width="50" class="draggable maincharacter" />
									</a>
								</td>
								<td width="25%">
									<a href="#" class="list-group-item" onmousedown="javascript:saveMainCharacter(3);">
										<h5>Fish</h5>
										<img src="<%= asset_path('fish-icon.png'); %>" width="50" class="draggable maincharacter" />
									</a>
								</td>
								<td width="25%">
									<a href="#" class="list-group-item" onmousedown="javascript:saveMainCharacter(8);">
										<h5>Bird</h5>
										<img src="<%= asset_path('bird-icon.png'); %>" width="50" class="draggable maincharacter" />
									</a>
								</td>
							</tr>
							<tr>
								
								<td width="25%" height="110">
									<a href="#" class="list-group-item" onmousedown="javascript:saveMainCharacter(5);">
										<h5>Car</h5>
										<img src="<%= asset_path('car-icon.png'); %>" width="50" class="draggable maincharacter" />
									</a>
								</td>
								<td width="25%">
									<a href="#" class="list-group-item" onmousedown="javascript:saveMainCharacter(6);">
										<h5>Robot</h5>
										<img src="<%= asset_path('robot-icon.png'); %>" width="50" class="draggable maincharacter" />
									</a>
								</td>
								<td width="25%">
									<a href="#" class="list-group-item" onmousedown="javascript:saveMainCharacter(7);">
										<h5>UFO</h5>
										<img src="<%= asset_path('ufo-icon.png'); %>" width="50" class="draggable maincharacter" />
									</a>
								</td>
								<td width="25%">
									<a href="#" class="list-group-item" onmousedown="javascript:saveMainCharacter(4);">
										<h5>Porcupine</h5>
										<img src="<%= asset_path('porcupine-icon.png'); %>" width="50" class="draggable maincharacter" />
									</a>
								</td>
							</tr>
						</table>
					</div>
				</div>
				<div class="goal col-lg-12">
					<br /><br />
					<h5><b>Drag a goal to an empty space.</b></h5>

					<div class="maze-goal">
						<table class="table table-bordered col-lg-12">
							<tr>
								<td width="25%" height="110">
									<a href="#" class="list-group-item" onmousedown="javascript:saveGoal(1);">
										<h5>Dog Bowl</h5>
										<img src="<%= asset_path('dog-bowl.png'); %>" width="50" class="draggable goal" />
									</a>
								</td>
								<td width="25%">
									<a href="#" class="list-group-item" onmousedown="javascript:saveGoal(2);">
										<h5>Yarn</h5>
										<img src="<%= asset_path('yarn-icon.png'); %>" width="50" class="draggable goal" />
									</a>
								</td>
								<td width="25%">
									<a href="#" class="list-group-item" onmousedown="javascript:saveGoal(3);">
										<h5>Treasure</h5>
										<img src="<%= asset_path('treasure-icon.png'); %>" width="50" class="draggable goal" />
									</a>
								</td>
								<td width="25%">
									<a href="#" class="list-group-item" onmousedown="javascript:saveGoal(4);">
										<h5>Nest</h5>
										<img src="<%= asset_path('nest-icon.png'); %>" width="50" class="draggable goal" />
									</a>
								</td>
							</tr>
							<tr>
								<td width="25%" height="110">
									<a href="#" class="list-group-item" onmousedown="javascript:saveGoal(5);">
										<h5>Map Pin</h5>
										<img src="<%= asset_path('mappin-icon.png'); %>" width="50" class="draggable goal" />
									</a>
								</td>
								<td width="25%">
									<a href="#" class="list-group-item" onmousedown="javascript:saveGoal(6);">
										<h5>Rocket</h5>
										<img src="<%= asset_path('rocket-icon.png'); %>" width="50" class="draggable goal" />
									</a>
								</td>
								<td width="25%">
									<a href="#" class="list-group-item" onmousedown="javascript:saveGoal(7);">
										<h5>Planet</h5>
										<img src="<%= asset_path('planet-icon.png'); %>" width="50" class="draggable goal" />
									</a>
								</td>
								<td width="25%">
									<a href="#" class="list-group-item" onmousedown="javascript:saveGoal(8);">
										<h5>Home</h5>
										<img src="<%= asset_path('house-icon.png'); %>" width="50" class="draggable goal" />
									</a>
								</td>
							</tr>
							</tr>
						</table>
					</div>
				</div>
			</div>

			<div class="col-lg-6">
				<div class="col-lg-12">
					<h5>&nbsp; &nbsp; &nbsp;<b><%= render :plain => @maze.title %></b></h5>
				</div>
				<div class="field col-lg-10">
					<div id="mazebuilder" style="float:right"></div>
						<%= f.hidden_field :layout, :value => @maze.layout %>
						<%= f.hidden_field :setting_id, :value => @maze.setting_id %>
						<%= f.hidden_field :main_character_id, :value => 1 %>
						<%= f.hidden_field :goal_id, :value => 1 %>
						<%= f.hidden_field :start %>
						<%= f.hidden_field :end %>
						<input type="hidden" name="step" id="step" value="<%= render plain: @maze.current_step %>" />
					</div>
					<div class="col-lg-2">
						<button type="button" class="btn btn-default" onmousedown='resetDraw()'>
						<%= image_tag "reset.png", width:'50', height:'50' %>
						</button>
					</div>			
				</div>

			<script type="text/javascript">
			$(window).load
	        {
				var mazePuzzle = new MazeLayout('mazebuilder',75,5,5);
				mazePuzzle.setMap(jQuery.parseJSON($('#maze_layout').val()));
	      		settingImg = mazePuzzle.setSetting($('#maze_setting_id').val());
	      		console.log($('#maze_setting_id').val());

	      		settingImg.onload = function()
	      		{
					mazePuzzle.show();
	      		}
			/*	function preload(arrayOfImages) {
					$(arrayOfImages).each(function () {
				        $('<img class="preloader" />').attr('src',this).appendTo('body').css('display','none');
				        console.log(this.src)
				    });
				};

				// Usage:
				preload(['<%= asset_path('dog.png') %>'],['<%= asset_path('cornstalk.png') %>'],['<%= asset_path('dog-bowl.png') %>']);
*/
				var counter = 0;

				$(".maincharacter").draggable(
					{
						stack:'#mazebuilder',
						helper: "clone",
						appendTo:"#mazebuilder",
						scroll:true,
						stop: function(event, ui)
						{
							clone = $(ui.helper).clone()[0];

							$(ui.helper).clone(true).removeClass('maincharacter ui-draggable ui-draggable-dragging').addClass('maincharacter-clone').css('top',clone.style.top).css('left',clone.style.left).appendTo('#mazebuilder').draggable({});
   
						}
					});

				$(".goal").draggable(
					{
						stack:'#mazebuilder',
						helper: "clone",
						appendTo:"#mazebuilder",
						scroll:true,
						stop: function(event, ui)
						{
							clone = $(ui.helper).clone()[0];

							$(ui.helper).clone(true).removeClass('goal ui-draggable ui-draggable-dragging').addClass('goal-clone').css('top',clone.style.top).css('left',clone.style.left).appendTo('#mazebuilder').draggable({});
   
						}
					});

				$("#mazebuilder").droppable({
					drop: function( event, ui ) {
				        saveCoordinates(this,event,ui)
			      	}
				});



			}
				function saveMainCharacter(maincharacter_id)
				{
					console.log("Main character: " + maincharacter_id)
					$("#maze_main_character_id").val(maincharacter_id);
				}

				function saveGoal(goal_id)
				{
					$("#maze_goal_id").val(goal_id);
				}

				function saveCoordinates(canvas,event,ui)
				{
					main_character_id = $("#maze_main_character_id").val();
					goal_id = $("#maze_goal_id").val();


					rect = $("#mazebuilder .maze")[0].getBoundingClientRect();
					x = event.clientX - rect.left;
					y = event.clientY - rect.top;
				
					col = Math.floor(x / 75);
					row = Math.floor(y / 75);

					endpoint = event.toElement.className;
					console.log(endpoint.indexOf("maincharacter"))

					if (endpoint.indexOf("maincharacter") >= 0)
					{
						console.log("tada!");
						$("#maze_start").val("[" + row + "," + col + "]");
						$("#maze_main_character_id").val(main_character_id);
					}
					else if (endpoint.indexOf("goal") >= 0)
					{
						$("#maze_end").val("[" + row + "," + col + "]");
						$("#maze_goal_id").val(goal_id);
					}
				}

				function resetDraw() {
					$('#goal').css('left', '20px').css('top', '40px');
					$('#maincharacter').css('left', '20px').css('top', '40px');
			    }

	    	</script>